<?php require '../config.php'; require '../includes/header.php'; if(!isset($_SESSION['role'])||$_SESSION['role']!=='admin'){ header('Location: ../login.php'); exit;} $msg=''; if($_SERVER['REQUEST_METHOD']==='POST'){ if(isset($_POST['add'])){ $u=trim($_POST['username']); $pw=md5(trim($_POST['password'])); $r=$_POST['role']; if($u!=''){ $st=$conn->prepare('INSERT INTO users (username,password,role,wallet) VALUES (?,?,?,0)'); $st->bind_param('sss',$u,$pw,$r); $st->execute(); $st->close(); $msg='User added'; } } if(isset($_POST['delete'])){ $id=intval($_POST['id']); $st=$conn->prepare('DELETE FROM users WHERE id=?'); $st->bind_param('i',$id); $st->execute(); $st->close(); $msg='Deleted'; } } $users=$conn->query('SELECT * FROM users ORDER BY id DESC'); ?>
<div class="card p-3"><h4>Manage Users</h4><?php if($msg) echo '<div class="alert alert-success">'.$msg.'</div>'; ?><form method="post" class="row g-2 mb-3"><div class="col"><input class="form-control" name="username" placeholder="username"></div><div class="col"><input class="form-control" name="password" placeholder="password"></div><div class="col"><select class="form-select" name="role"><option value="student">student</option><option value="staff">staff</option><option value="admin">admin</option></select></div><div class="col-auto"><button class="btn btn-primary" name="add">Add</button></div></form><table class="table"><thead><tr><th>ID</th><th>Username</th><th>Role</th><th>Wallet</th><th>Action</th></tr></thead><tbody><?php while($u=$users->fetch_assoc()): ?><tr><td><?= (int)$u['id'] ?></td><td><?= htmlspecialchars($u['username']) ?></td><td><?= htmlspecialchars($u['role']) ?></td><td><?= number_format($u['wallet'],2) ?></td><td><form method="post"><input type="hidden" name="id" value="<?= (int)$u['id'] ?>"><button class="btn btn-sm btn-danger" name="delete" onclick="return confirm('Delete?')">Delete</button></form></td></tr><?php endwhile; ?></tbody></table></div>
<?php require '../includes/footer.php'; ?>