<?php require '../config.php'; require '../includes/header.php'; if(!isset($_SESSION['role'])||$_SESSION['role']!=='admin'){ header('Location: ../login.php'); exit;} $msg=''; if($_SERVER['REQUEST_METHOD']==='POST'){ if(isset($_POST['add'])){ $n=trim($_POST['name']); $p=floatval($_POST['price']); $s=intval($_POST['stock']); if($n!='' && $p>0){ $st=$conn->prepare('INSERT INTO menu (item_name,price,stock) VALUES (?,?,?)'); $st->bind_param('sdi',$n,$p,$s); $st->execute(); $st->close(); $msg='Added'; } } if(isset($_POST['update'])){ $id=intval($_POST['id']); $p=floatval($_POST['price']); $s=intval($_POST['stock']); $st=$conn->prepare('UPDATE menu SET price=?,stock=? WHERE id=?'); $st->bind_param('dii',$p,$s,$id); $st->execute(); $st->close(); $msg='Updated'; } if(isset($_POST['delete'])){ $id=intval($_POST['id']); $st=$conn->prepare('DELETE FROM menu WHERE id=?'); $st->bind_param('i',$id); $st->execute(); $st->close(); $msg='Deleted'; } } $items=$conn->query('SELECT * FROM menu ORDER BY id DESC'); ?>
<div class="card p-3"><h4>Manage Stock</h4><?php if($msg) echo '<div class="alert alert-success">'.$msg.'</div>'; ?><form method="post" class="row g-2 mb-3"><div class="col"><input class="form-control" name="name" placeholder="Name"></div><div class="col"><input class="form-control" name="price" type="number" step="0.01" placeholder="Price"></div><div class="col"><input class="form-control" name="stock" type="number" value="10"></div><div class="col-auto"><button class="btn btn-primary" name="add">Add</button></div></form><table class="table"><thead><tr><th>ID</th><th>Item</th><th>Price</th><th>Stock</th><th>Action</th></tr></thead><tbody><?php while($it=$items->fetch_assoc()): ?><tr class="<?= $it['stock']<10 ? 'table-danger':'' ?>"><td><?= (int)$it['id'] ?></td><td><?= htmlspecialchars($it['item_name']) ?></td><td><?= number_format($it['price'],2) ?></td><td><?= (int)$it['stock'] ?></td><td><form method="post" class="d-flex gap-2"><input type="hidden" name="id" value="<?= (int)$it['id'] ?>"><input class="form-control" style="width:80px" name="price" type="number" step="0.01" value="<?= $it['price'] ?>"><input class="form-control" style="width:80px" name="stock" type="number" value="<?= (int)$it['stock'] ?>"><button class="btn btn-sm btn-success" name="update">Update</button><button class="btn btn-sm btn-danger" name="delete" onclick="return confirm('Delete?')">Delete</button></form></td></tr><?php endwhile; ?></tbody></table></div>
<?php require '../includes/footer.php'; ?>